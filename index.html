<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimizer</title>
<style>
/* --- CSS bez zmian (to co miałeś) --- */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
:root {
  --primary-color: #7b2cbf;
  --primary-hover: #9d4edd;
  --discord-color: #5865F2;
  --discord-hover: #4752c4;
  --danger-color: #f03e3e;
  --text-color: #fff;
  --text-muted: #d0d0d0;
  --bg-dark: #1a1a1a;
  --bg-light: #2c2c2e;
}
/* ... reszta CSS co miałeś ... */
</style>
</head>
<body>

<nav>
  <div class="left">
    <div class="logo">O</div>
    <div class="brand">Optimizer</div>
  </div>
  <div class="menu">
    <a href="#hero">Strona główna</a>
    <a href="#oferta">Zakup</a>
    <a href="#faq">FAQ</a>
  </div>
  <div id="auth-container"></div>
</nav>

<main>
  <section id="hero" class="section">
    <h1>Optimizer</h1>
    <p>Jedne z tańszych i najlepszych Cheat Clientów!</p>
    <a href="#oferta" class="btn">Zobacz Oferte</a>
  </section>

  <section id="oferta" class="section">
    <h2>Nasza Oferta</h2>
    <p>Wybierz plan, który najlepiej pasuje do Twoich potrzeb i dołącz do grona najlepszych graczy!</p>
    <div class="pricing-container">
      <div class="pricing-card">
        <h3>1 Miesiąc</h3>
        <div class="price">20 PLN</div>
        <a href="#" class="btn">Kup teraz</a>
      </div>
      <div class="pricing-card recommended">
        <div class="recommended-badge">Najbardziej opłacalne</div>
        <h3>Lifetime</h3>
        <div class="price">60 PLN</div>
        <a href="#" class="btn">Kup teraz</a>
      </div>
      <div class="pricing-card">
        <h3>3 Miesiące</h3>
        <div class="price">45 PLN</div>
        <a href="#" class="btn">Kup teraz</a>
      </div>
    </div>
  </section>

  <section id="faq" class="section">
    <h2>FAQ</h2>
    <p>Masz pytania? Sprawdź najczęściej zadawane pytania i odpowiedzi. Jeśli nie znajdziesz tego, czego szukasz, skontaktuj się z nami.</p>
  </section>
</main>

<!-- Modal Wylogowania -->
<div id="logout-modal" class="modal-overlay">
  <div class="modal-content">
    <p>Czy na pewno chcesz się wylogować?</p>
    <div class="modal-buttons">
      <button id="confirm-logout-btn" class="modal-btn-confirm">Tak, wyloguj</button>
      <button class="modal-btn-cancel close-modal">Anuluj</button>
    </div>
  </div>
</div>

<!-- Modal Ustawień -->
<div id="settings-modal" class="modal-overlay">
  <div class="modal-content">
    <h2>Ustawienia</h2>
    <p>Ta funkcja jest w trakcie budowy. Wkrótce pojawią się tutaj opcje personalizacji Twojego konta.</p>
    <div class="modal-buttons">
       <button class="modal-btn-cancel close-modal">Zamknij</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const authContainer = document.getElementById('auth-container');
    const logoutModal = document.getElementById('logout-modal');
    const settingsModal = document.getElementById('settings-modal');
    const confirmLogoutBtn = document.getElementById('confirm-logout-btn');
    const closeModalBtns = document.querySelectorAll('.close-modal');

    let loggedIn = false;
    let userPanel = null;
    let user = {};

    const discordBtn = document.createElement('a');
    discordBtn.className = 'discord-btn';
    const discordOAuthURL = "https://discord.com/oauth2/authorize?client_id=1421883621719019531&response_type=token&redirect_uri=https%3A%2F%2Fgrowek.github.io%2FOptimizerWEB%2F&scope=identify";

    function setDiscordLoginButton() {
        discordBtn.href = discordOAuthURL;
        discordBtn.innerHTML = `<img src="https://www.svgrepo.com/show/353655/discord-icon.svg" alt="Discord logo"> Połącz z Discordem`;
        authContainer.innerHTML = "";
        authContainer.appendChild(discordBtn);
    }
    setDiscordLoginButton();

    // --- Token w localStorage / URL
    let token = localStorage.getItem("discord_token");
    const hash = window.location.hash.substr(1);
    const urlToken = new URLSearchParams(hash).get('access_token');

    if (urlToken) {
        token = urlToken;
        localStorage.setItem("discord_token", token);
        window.location.hash = ''; // wyczyść URL
    }

    if (token) {
        fetch('https://discord.com/api/v10/users/@me', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(res => res.json())
        .then(u => {
            if (u.id) {
                user = {
                    username: `${u.username}#${u.discriminator}`,
                    avatar: u.avatar 
                        ? `https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png?size=128`
                        : 'https://placehold.co/128x128/f3f4f6/111827?text=Avatar'
                };
                loginUser();
            } else {
                logoutUser();
            }
        });
    }

    function loginUser() {
        loggedIn = true;
        authContainer.innerHTML = `
            <img src="${user.avatar}" alt="Avatar" id="user-avatar" style="width:40px; height:40px; border-radius:50%; cursor:pointer;">
        `;
        if (!userPanel) {
            createUserPanel();
        }
        const avatarBtn = document.getElementById('user-avatar');
        avatarBtn.addEventListener('click', () => {
            userPanel.classList.toggle('show');
        });
    }

    function logoutUser() {
        loggedIn = false;
        localStorage.removeItem("discord_token"); // usuń token
        if(userPanel) {
            userPanel.remove();
            userPanel = null;
        }
        user = {};
        setDiscordLoginButton();
        window.location.hash = '';
        logoutModal.classList.remove('show');
    }

    function createUserPanel() {
        userPanel = document.createElement('div');
        userPanel.className = 'user-panel';
        userPanel.innerHTML = `
            <img src="${user.avatar}" class="user-avatar">
            <div class="user-name">${user.username}</div>
            <button class="settings-btn">Ustawienia</button>
            <button class="logout-btn">Wyloguj</button>
        `;
        document.body.appendChild(userPanel);

        userPanel.querySelector('.logout-btn').addEventListener('click', () => {
            userPanel.classList.remove('show');
            logoutModal.classList.add('show');
        });

        userPanel.querySelector('.settings-btn').addEventListener('click', () => {
            userPanel.classList.remove('show');
            settingsModal.classList.add('show');
        });
    }

    confirmLogoutBtn.addEventListener('click', logoutUser);

    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            logoutModal.classList.remove('show');
            settingsModal.classList.remove('show');
        });
    });

    window.addEventListener('click', (e) => {
        if (e.target === logoutModal || e.target === settingsModal) {
            e.target.classList.remove('show');
        }
        if(userPanel && !userPanel.contains(e.target) && e.target.id !== "user-avatar"){
            userPanel.classList.remove('show');
        }
    });
});
</script>
</body>
</html>
